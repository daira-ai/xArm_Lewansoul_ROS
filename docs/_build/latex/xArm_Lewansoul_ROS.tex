%% Generated by Sphinx.
\def\sphinxdocclass{daira-manual}
\documentclass[letterpaper,10pt,english]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax
\ifdefined\pdfimageresolution
    \pdfimageresolution= \numexpr \dimexpr1in\relax/\sphinxpxdimen\relax
\fi
%% let collapsible pdf bookmarks panel have high depth per default
\PassOptionsToPackage{bookmarksdepth=5}{hyperref}
%% turn off hyperref patch of \index as sphinx.xdy xindy module takes care of
%% suitable \hyperpage mark-up, working around hyperref-xindy incompatibility
\PassOptionsToPackage{hyperindex=false}{hyperref}
%% memoir class requires extra handling
\makeatletter\@ifclassloaded{memoir}
{\ifdefined\memhyperindexfalse\memhyperindexfalse\fi}{}\makeatother

\PassOptionsToPackage{booktabs}{sphinx}
\PassOptionsToPackage{colorrows}{sphinx}

\PassOptionsToPackage{warn}{textcomp}

\catcode`^^^^00a0\active\protected\def^^^^00a0{\leavevmode\nobreak\ }
\usepackage{cmap}
\usepackage{fontspec}
\defaultfontfeatures[\rmfamily,\sffamily,\ttfamily]{}
\usepackage{amsmath,amssymb,amstext}
\usepackage{polyglossia}
\setmainlanguage{english}



    \usepackage{fontspec}
    \setsansfont{Roboto}[
        Path = ,
        Extension = .ttf,
        UprightFont = *-Regular,
        %-- Upright --%
        FontFace={ul}{n}{Font=*-Thin},
        FontFace={l}{n}{Font=*-Light},
        FontFace={m}{n}{Font=*-Regular},
        FontFace={mb}{n}{Font=*-Medium},
        FontFace={b}{n}{Font=*-Bold},
        FontFace={eb}{n}{Font=*-Black},
        % %-- Italic --%
        FontFace={ul}{it}{Font=*-ThinItalic},
        FontFace={l}{it}{Font=*-LightItalic},
        FontFace={m}{it}{Font=*-Italic},
        FontFace={mb}{it}{Font=*-MediumItalic},
        FontFace={b}{it}{Font=*-BoldItalic},
        FontFace={eb}{it}{Font=*-BlackItalic},
    ]
    \setmainfont{Roboto}[
        Path = ,
        Extension = .ttf,
        UprightFont = *-Light,
        %-- Upright --%
        FontFace={ul}{n}{Font=*-Thin},
        FontFace={l}{n}{Font=*-Light},
        FontFace={m}{n}{Font=*-Regular},
        FontFace={mb}{n}{Font=*-Medium},
        FontFace={b}{n}{Font=*-Bold},
        FontFace={eb}{n}{Font=*-Black},
        % %-- Italic --%
        FontFace={ul}{it}{Font=*-ThinItalic},
        FontFace={l}{it}{Font=*-LightItalic},
        FontFace={m}{it}{Font=*-Italic},
        FontFace={mb}{it}{Font=*-MediumItalic},
        FontFace={b}{it}{Font=*-BoldItalic},
        FontFace={eb}{it}{Font=*-BlackItalic},
    ]
    


\usepackage[Bjarne]{fncychap}
\usepackage{sphinx}
\sphinxsetup{hmargin={0.7in,0.7in}, vmargin={1in,1in}}
\fvset{fontsize=\small}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}

\addto\captionsenglish{\renewcommand{\contentsname}{Overview}}

\usepackage{sphinxmessages}
\setcounter{tocdepth}{2}


    \titleformat{\chapter}[display]
        {\flushright}
        {\fontsize{96}{96}\selectfont\largetitlestyle\thechapter}
        {0pt}
        {\Huge\titlestyle}
    \titlespacing*{\chapter}{0pt}{0pt}{2\baselineskip}

    %% Formatting section titles and spacing
    \titleformat{\section}
        {\Large\titlestyle}
        {\thesection.}
        {5pt}
        {}
    \titlespacing*{\section}{0pt}{\baselineskip}{0pt}

    %% Formatting subsections titles and spacing
    \titleformat{\subsection}
        {\large\titlestyle}
        {\thesubsection.}
        {5pt}
        {}
    \titlespacing*{\subsection}{0pt}{\baselineskip}{0pt}

    %% Formatting subsubsections titles and spacing
    \titleformat{\subsubsection}
        {\titlestyle}
        {}
        {0pt}
        {}
    \titlespacing*{\subsubsection}{0pt}{\bigskipamount}{0pt}
    

\title{xArm Lewansoul ROS Documentation}
\date{Nov 23, 2023}
\release{F\_improving\_docs}
\author{Daira AI}
\newcommand{\sphinxlogo}{\sphinxincludegraphics{Daira_Logo.png}\par}
\renewcommand{\releasename}{Release}
\makeindex
\begin{document}

\pagestyle{empty}

    \pagenumbering{Roman}
    \begin{titlepage}

    %% Defining the main parameters
    
    %\author{Daira AI}
    %\subject{Manual}
    \dairacopyright{Copyright Â© 2023-2023 by Daira AI. All rights reserved}
    \dairarelease{\detokenize{F_improving_docs}}

    \coverimage{ManualCover.png}
    \definecolor{title}{HTML}{D00070} % Color for title
    \makecover

    \end{titlepage}
    \clearpage
    \tableofcontents
    \clearpage
    \pagenumbering{arabic}
    
\pagestyle{plain}
 
\pagestyle{normal}
\phantomsection\label{\detokenize{index::doc}}



\chapter{Preface}
\label{\detokenize{index:preface}}
\sphinxAtStartPar
This is the documentation for ROS integration of the \sphinxhref{https://www.hiwonder.hk/collections/robotic-arm/products/xarm-hiwonder-6dof-bus-servo-robotic-arm-based-on-scratch-arduino-programmable-robotic-arm}{Lewansoul\sphinxhyphen{}Hiwonder xArm}.

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[width=0.500\linewidth]{{xarm_2048x2048}.jpg}
\end{figure}

\sphinxAtStartPar
Here you will find:
\begin{itemize}
\item {} 
\sphinxAtStartPar
Low level drivers to comunicate with the robot either in python or C++

\item {} 
\sphinxAtStartPar
Hardware interface to control the robot with either position or trajectory control

\item {} 
\sphinxAtStartPar
Integration with RVIZ and Moveit! including URDF and SRDF files which allow you to plan trajectories

\end{itemize}

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
At the moment the gripper has not been yet integrated.
\end{sphinxadmonition}


\chapter{Overview}
\label{\detokenize{index:overview}}\begin{itemize}
\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{user_guide/1_1_introduction::doc}]{\sphinxcrossref{\DUrole{doc}{Quick Start}}}}

\end{itemize}

\sphinxstepscope


\section{Quick Start}
\label{\detokenize{user_guide/1_1_introduction:quick-start}}\label{\detokenize{user_guide/1_1_introduction::doc}}

\subsection{Installation}
\label{\detokenize{user_guide/1_1_introduction:installation}}

\subsubsection{System requirements}
\label{\detokenize{user_guide/1_1_introduction:system-requirements}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Ubuntu 18.04

\item {} 
\sphinxAtStartPar
ROS Melodic

\end{itemize}


\subsubsection{Install package dependencies}
\label{\detokenize{user_guide/1_1_introduction:install-package-dependencies}}


\begin{Verbatim}[commandchars=\\\{\}]
$ sudo apt-get install libhidapi-hidraw0 libhidapi-libusb0
$ pip install --user hid
$ sudo apt-get install python-dev libusb-1.0-0-dev libudev-dev
$ sudo pip install --upgrade setuptools
$ sudo pip install hidapi
\end{Verbatim}


\subsubsection{Install HIDAPI}
\label{\detokenize{user_guide/1_1_introduction:install-hidapi}}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Clone hidapi from  \sphinxurl{https://github.com/libusb/hidapi}

\item {} 
\sphinxAtStartPar
Install dependencies as mentioned in hidapi repository:



\begin{Verbatim}[commandchars=\\\{\}]
$ sudo apt-get install libudev-dev libusb-1.0-0-dev libfox-1.6-dev
$ sudo apt-get install autotools-dev autoconf automake libtool
\end{Verbatim}

\item {} 
\sphinxAtStartPar
Run all the commands to build as mentioned in the readme of the repository:



\begin{Verbatim}[commandchars=\\\{\}]
$ ./bootstrap
$ ./configure
$ make
$ sudo make install
\end{Verbatim}

\end{enumerate}


\subsubsection{Build xArm\_Lewansoul\_ROS}
\label{\detokenize{user_guide/1_1_introduction:build-xarm-lewansoul-ros}}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Clone this repository



\begin{Verbatim}[commandchars=\\\{\}]
$ git clone https://github.com/diestra-ai/xArm_Lewansoul_ROS.git
\end{Verbatim}

\item {} 
\sphinxAtStartPar
Build



\begin{Verbatim}[commandchars=\\\{\}]
$ catkin_make
\end{Verbatim}

\end{enumerate}


\subsection{Run}
\label{\detokenize{user_guide/1_1_introduction:run}}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Connect the robot to any USB port of your computer

\item {} 
\sphinxAtStartPar
Turn the robot on.
You should see the pink and blue lights on the control card.

\item {} 
\sphinxAtStartPar
To control the robot with code you sould be in sudo mode



\begin{Verbatim}[commandchars=\\\{\}]
$ sudo -s
\end{Verbatim}

\item {} 
\sphinxAtStartPar
Run the following script to check the computer is  able to detect and control the robot.
You should be in the folder of xArm\_Lewansoul\_ROS



\begin{Verbatim}[commandchars=\\\{\}]
$ python xarm_hardware_interface/scripts/controller.py
\end{Verbatim}
\begin{itemize}
\item {} 
\sphinxAtStartPar
If the robot is correctly detected you should see the following output:

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[width=0.700\linewidth]{{python_output}.png}
\end{figure}

\item {} 
\sphinxAtStartPar
The robot should move to a vertical position and then open and close the gripper followed by rotating its second and third joints.

\item {} 
\sphinxAtStartPar
If the robot is not detected the following output would appear:

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[width=0.700\linewidth]{{python_output_error}.png}
\end{figure}

\sphinxAtStartPar
in this case check that the robot is on and that you are running from sudo mode, or try another USB port or cable. Also maybe restart the system.

\sphinxAtStartPar
With this python file you can use different functions to control the robot.

\end{itemize}

\item {} 
\sphinxAtStartPar
Control the robot using ROS

\sphinxAtStartPar
To have the robot running in ROS, launch the following



\begin{Verbatim}[commandchars=\\\{\}]
$ roslaunch xarm_launch xarm.launch
\end{Verbatim}

\end{enumerate}


\chapter{Software Description}
\label{\detokenize{index:software-description}}\begin{itemize}
\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{user_guide/1_2_software_description::doc}]{\sphinxcrossref{\DUrole{doc}{Driver Description}}}}

\end{itemize}

\sphinxstepscope


\section{Driver Description}
\label{\detokenize{user_guide/1_2_software_description:driver-description}}\label{\detokenize{user_guide/1_2_software_description::doc}}

\subsection{USB Protocol}
\label{\detokenize{user_guide/1_2_software_description:usb-protocol}}
\sphinxAtStartPar
A repository describing the communication protocol was found here: \sphinxurl{https://github.com/ccourson/LewanSoul-xArm}.

\sphinxAtStartPar
From there, we took the information about the protocol to communicate with the robot.

\sphinxAtStartPar
A packet transmitted to the xArm will have the following format:


\begin{savenotes}\sphinxattablestart
\sphinxthistablewithglobalstyle
\centering
\begin{tabulary}{\linewidth}[t]{TTTTTT}
\sphinxtoprule
\sphinxtableatstartofbodyhook&
\sphinxAtStartPar
id
&
\sphinxAtStartPar
header
&
\sphinxAtStartPar
length
&
\sphinxAtStartPar
command
&
\sphinxAtStartPar
parameters
\\
\sphinxhline
\sphinxAtStartPar
Bytes
&
\sphinxAtStartPar
1
&
\sphinxAtStartPar
2
&
\sphinxAtStartPar
1
&
\sphinxAtStartPar
1
&
\sphinxAtStartPar
0 or more
\\
\sphinxhline
\sphinxAtStartPar
Comments
&
\sphinxAtStartPar
Any number.
&
\sphinxAtStartPar
Always 0x5555.
&
\sphinxAtStartPar
Here to end.
&
\sphinxAtStartPar
See commands.
&
\sphinxAtStartPar
See commands.
\\
\sphinxbottomrule
\end{tabulary}
\sphinxtableafterendhook\par
\sphinxattableend\end{savenotes}

\sphinxAtStartPar
Commands are essentially request packets embedded into USB HID reports. Requests and responses are described in the following syntax:
\begin{itemize}
\item {} 
\sphinxAtStartPar
Each field is seperated by a space.

\item {} 
\sphinxAtStartPar
Each field is described by the type in parentheses.

\item {} 
\sphinxAtStartPar
Curly braces denote that their content may be repeated more than once.

\end{itemize}

\sphinxAtStartPar
The following are the set of available requests:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
ServoMove             3  (byte)count (ushort)time \PYGZob{} (byte)id (ushort)position \PYGZcb{}
GroupRunRepeat        5  (byte)group[255=all] (byte)times
GroupRun              6  (byte)group (ushort)count[0=continuous]
GroupStop             7  \PYGZhy{}none\PYGZhy{}
GroupErase            8  (byte)group[255=all]
GroupSpeed           11  (byte)group (ushort)percentage
xServoOffsetWrite    12  *** not sure
xServoOffsetRead     13  *** not sure
xServoOffsetAdjust   14  *** not sure
GetBatteryVoltage    15  \PYGZhy{}none\PYGZhy{}; (ushort)millivolts
ServoOff             20  (byte)count \PYGZob{} (byte)id \PYGZcb{}
ServoPositionRead    21  (byte)count \PYGZob{} (byte)id \PYGZcb{}; (byte)count \PYGZob{} (byte)id (ushort)position \PYGZcb{}
ServoPositionWrite   22  (byte)count \PYGZob{} (byte)id (ushort)position \PYGZcb{}
ServoOffsetRead      23  (byte)count \PYGZob{} (byte)id \PYGZcb{}; (byte)count \PYGZob{} (byte)id (sbyte)offset \PYGZcb{}
ServoOffsetWrite     24  (byte)id (sbyte)offset
BusServoMoroCtrl     26  (byte)id (byte)??? (ushort)speed
\end{sphinxVerbatim}

\sphinxAtStartPar
Taking this information, we have created files to control the robot in python and c++. We have subsequently used the c++ implementation to create the following robot interfaces but we have left the python one in case it is helpful for someone.


\subsubsection{Python driver}
\label{\detokenize{user_guide/1_2_software_description:python-driver}}
\sphinxAtStartPar
We found the following \sphinxhref{https://gist.github.com/maximecb/7fd42439e8a28b9a74a4f7db68281071}{implementation in python for this robot} (Author: Maxime Chevalier\sphinxhyphen{}Boisvert). We modified it and you can find it \sphinxhref{https://github.com/diestra-ai/xArm\_Lewansoul\_ROS/blob/melodic-devel/xarm\_hardware\_interface/scripts/controller.py}{here}.

\sphinxAtStartPar
To run it, turn the robot on and run the following:



\begin{Verbatim}[commandchars=\\\{\}]
$ sudo -s
$ python xarm_hardware_interface/scripts/controller.py
\end{Verbatim}

\sphinxAtStartPar
There are some commands that will be executed as examples of how to control the robot. You should see the robot doing some movements.


\subsubsection{C++ driver}
\label{\detokenize{user_guide/1_2_software_description:c-driver}}
\sphinxAtStartPar
Starting from the python implementation, we have created the c++ version of it that you can find \sphinxhref{https://github.com/diestra-ai/xArm\_Lewansoul\_ROS/blob/melodic-devel/xarm\_hardware\_interface/src/xarm.cpp}{here}

\sphinxAtStartPar
Since there is not information about the joint limits in the robot manual, we have manually found out the values in units by using the Lewansoul mobile app. Then, we calculated their equivalent in radians setting the zero when the robot is in the vertical position as showing in the following picture:

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[width=0.300\linewidth]{{xarm_zero}.png}
\end{figure}


\begin{savenotes}\sphinxattablestart
\sphinxthistablewithglobalstyle
\centering
\begin{tabulary}{\linewidth}[t]{TTTTT}
\sphinxtoprule
\sphinxtableatstartofbodyhook\sphinxmultirow{2}{1}{%
\begin{varwidth}[t]{\sphinxcolwidth{1}{5}}
\sphinxAtStartPar
Joint
\par
\vskip-\baselineskip\vbox{\hbox{\strut}}\end{varwidth}%
}%
&\sphinxstartmulticolumn{4}%
\begin{varwidth}[t]{\sphinxcolwidth{4}{5}}
\sphinxAtStartPar
Units
\par
\vskip-\baselineskip\vbox{\hbox{\strut}}\end{varwidth}%
\sphinxstopmulticolumn
\\
\sphinxcline{2-5}\sphinxfixclines{5}\sphinxtablestrut{1}&
\sphinxAtStartPar
Min
&
\sphinxAtStartPar
Max
&
\sphinxAtStartPar
\sphinxhyphen{}pi/2
&
\sphinxAtStartPar
pi/2
\\
\sphinxhline
\sphinxAtStartPar
2
&
\sphinxAtStartPar
50
&
\sphinxAtStartPar
995
&
\sphinxAtStartPar
200
&
\sphinxAtStartPar
980
\\
\sphinxhline
\sphinxAtStartPar
3
&
\sphinxAtStartPar
100
&
\sphinxAtStartPar
950
&
\sphinxAtStartPar
140
&
\sphinxAtStartPar
880
\\
\sphinxhline
\sphinxAtStartPar
4
&
\sphinxAtStartPar
50
&
\sphinxAtStartPar
950
&
\sphinxAtStartPar
130
&
\sphinxAtStartPar
870
\\
\sphinxhline
\sphinxAtStartPar
5
&
\sphinxAtStartPar
135
&
\sphinxAtStartPar
950
&
\sphinxAtStartPar
140
&
\sphinxAtStartPar
880
\\
\sphinxhline
\sphinxAtStartPar
6
&
\sphinxAtStartPar
50
&
\sphinxAtStartPar
900
&
\sphinxAtStartPar
90
&
\sphinxAtStartPar
845
\\
\sphinxbottomrule
\end{tabulary}
\sphinxtableafterendhook\par
\sphinxattableend\end{savenotes}


\begin{savenotes}\sphinxattablestart
\sphinxthistablewithglobalstyle
\centering
\begin{tabulary}{\linewidth}[t]{TTT}
\sphinxtoprule
\sphinxtableatstartofbodyhook\sphinxmultirow{2}{1}{%
\begin{varwidth}[t]{\sphinxcolwidth{1}{3}}
\sphinxAtStartPar
Joint
\par
\vskip-\baselineskip\vbox{\hbox{\strut}}\end{varwidth}%
}%
&\sphinxstartmulticolumn{2}%
\begin{varwidth}[t]{\sphinxcolwidth{2}{3}}
\sphinxAtStartPar
Radians
\par
\vskip-\baselineskip\vbox{\hbox{\strut}}\end{varwidth}%
\sphinxstopmulticolumn
\\
\sphinxcline{2-3}\sphinxfixclines{3}\sphinxtablestrut{1}&
\sphinxAtStartPar
Min
&
\sphinxAtStartPar
Max
\\
\sphinxhline
\sphinxAtStartPar
2
&
\sphinxAtStartPar
\sphinxhyphen{}2.17494876
&
\sphinxAtStartPar
1.63121157
\\
\sphinxhline
\sphinxAtStartPar
3
&
\sphinxAtStartPar
\sphinxhyphen{}1.740612146
&
\sphinxAtStartPar
1.86797401
\\
\sphinxhline
\sphinxAtStartPar
4
&
\sphinxAtStartPar
\sphinxhyphen{}1.910427965
&
\sphinxAtStartPar
1.910427965
\\
\sphinxhline
\sphinxAtStartPar
5
&
\sphinxAtStartPar
\sphinxhyphen{}1.592023304
&
\sphinxAtStartPar
1.86797401
\\
\sphinxhline
\sphinxAtStartPar
6
&
\sphinxAtStartPar
\sphinxhyphen{}1.737238322
&
\sphinxAtStartPar
1.79965407
\\
\sphinxbottomrule
\end{tabulary}
\sphinxtableafterendhook\par
\sphinxattableend\end{savenotes}


\section{Hardware Interface}
\label{\detokenize{user_guide/1_2_software_description:hardware-interface}}
\sphinxAtStartPar
We used \sphinxhref{https://www.slaterobotics.com/blog/5abd8a1ed4442a651de5cb5b/how-to-implement-ros\_control-on-a-custom-robot}{this following tutorial} to create the ros\_control interfaces for this robot. You can find our implementation \sphinxhref{https://github.com/diestra-ai/xArm\_Lewansoul\_ROS/tree/melodic-devel/xarm\_hardware\_interface}{here}.


\section{URDF}
\label{\detokenize{user_guide/1_2_software_description:urdf}}
\sphinxAtStartPar
Meshes were taken from  \sphinxurl{https://grabcad.com/library/lewansoul-6dof-robot-arm-1}. Different links were exported as single files using Solidworks. The origin and orientation were changed using Blender according with the axis of rotation of the real robot. Joints were defined in the \sphinxhref{https://github.com/diestra-ai/xArm\_Lewansoul\_ROS/blob/melodic-devel/xarm\_description/urdf/xarm.urdf}{URDF file}.

\begin{sphinxadmonition}{warning}{Warning:}
\sphinxAtStartPar
At the moment, there is no information about inertia.
\end{sphinxadmonition}


\section{RVIZ\sphinxhyphen{}MoveIt!}
\label{\detokenize{user_guide/1_2_software_description:rviz-moveit}}
\sphinxAtStartPar
Running \sphinxcode{\sphinxupquote{xarm.launch}} file will launch MoveIt! and RVIZ integration that will allow you to plan trajectories. In this case the joints are controlled using trayectory controller.



\begin{Verbatim}[commandchars=\\\{\}]
$ roslaunch xarm_launch xarm.launch
\end{Verbatim}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[width=0.900\linewidth]{{xarm_RVIZ}.png}
\end{figure}

\sphinxAtStartPar
We have integrated xArm with MoveIt! using MoveIt! Setup Assistant. \sphinxhref{https://github.com/diestra-ai/xArm\_Lewansoul\_ROS/tree/f\_documentation/xarm\_moveit\_config}{Here}. you can find the Moveit! configuration and the srdf file  \sphinxhref{https://github.com/diestra-ai/xArm\_Lewansoul\_ROS/blob/f\_documentation/xarm\_moveit\_config/config/xarm.srdf}{here}.

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
You can control the robot using only position control using the following launch file:



\begin{Verbatim}[commandchars=\\\{\}]
$ roslaunch xarm_hardware_interface xarm_position_controller.launch
\end{Verbatim}
\end{sphinxadmonition}



\renewcommand{\indexname}{Index}
\printindex
\end{document}